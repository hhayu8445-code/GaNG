# CFX V7 Decryptor - Discord Bot Only

## System Architecture

**Decrypt Process:** Discord Bot Only  
**Download:** Website (https://www.fivemtools.net)

## Flow Diagram

```
User → Discord Bot (/decrypt command)
         ↓
Bot processes file (decrypt)
         ↓
Bot generates Download ID (8 chars)
         ↓
Bot sends result to website webhook
         ↓
User enters Download ID on website
         ↓
Website serves decrypted file
```

## Website Configuration

### Environment Variables (.env.local)

```env
NEXT_PUBLIC_SITE_URL=https://www.fivemtools.net
DISCORD_CLIENT_ID=1445650115447754933
DISCORD_CLIENT_SECRET=6JSK5ydHewv7DmZlhHa6P1e4q-pbFXe_
DISCORD_REDIRECT_URI=https://www.fivemtools.net/api/auth/callback
ADMIN_DISCORD_ID=1047719075322810378
SESSION_SECRET=8d620c8be350b3f109738dbd7ff30bfd

# Discord Bot Integration
DISCORD_DECRYPT_WEBHOOK=https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_WEBHOOK_TOKEN
DISCORD_BOT_API_URL=http://https://fivemtools.net
DISCORD_BOT_API_KEY=your-secure-api-key-here
```

## API Endpoints

### 1. POST /api/decrypt/webhook

**Purpose:** Receive decrypted files from Discord bot

**Headers:**

```
Authorization: Bearer your-secure-api-key-here
Content-Type: application/json
```

**Request Body:**

```json
{
  "downloadId": "A1B2C3D4",
  "filename": "resource_decrypted.lua",
  "content": "-- decrypted lua code here",
  "status": "completed",
  "jobId": "optional-job-id"
}
```

**Response:**

```json
{
  "success": true,
  "message": "Download stored successfully",
  "downloadUrl": "https://www.fivemtools.net/api/decrypt/download/A1B2C3D4"
}
```

### 2. GET /api/decrypt/download/[id]

**Purpose:** Download decrypted file

**URL:** `/api/decrypt/download/A1B2C3D4`

**Response:** File download (text/plain)

**Features:**

- 24-hour expiry check
- Auto-delete expired downloads
- Proper download headers

## Discord Bot Integration

### Bot Must Send to Webhook

After decryption completes, bot sends:

```javascript
fetch("https://www.fivemtools.net/api/decrypt/webhook", {
  method: "POST",
  headers: {
    Authorization: "Bearer your-secure-api-key-here",
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    downloadId: "A1B2C3D4", // 8-char uppercase
    filename: "resource_decrypted.lua",
    content: decryptedContent, // full lua code
    status: "completed",
  }),
});
```

### Download ID Format

- Length: 8 characters
- Format: Uppercase alphanumeric (A-Z, 0-9)
- Example: `A1B2C3D4`, `F7E8D9C0`
- Generated by: `crypto.randomBytes(4).toString('hex').toUpperCase()`

## User Flow

1. User joins Discord server
2. **User posts vouch in vouch channel (REQUIRED)**
3. User runs `/decrypt` command
4. User uploads encrypted .ZIP file
5. Bot processes file (decrypt + decompile)
6. Bot generates Download ID: `A1B2C3D4`
7. Bot sends to website webhook
8. Bot replies to user with Download ID
9. User goes to https://www.fivemtools.net/decrypt
10. **Website checks if user has posted vouch**
11. User enters Download ID: `A1B2C3D4`
12. User clicks "Download Decrypted File"
13. Browser downloads the file

## Security Features

✅ API key authentication for webhook  
✅ 24-hour download expiry  
✅ Session-based user authentication  
✅ No file upload on website  
✅ Download ID is random & unique  
✅ **Vouch requirement (Channel: 1445794466605826343)**

## Website Features

✅ Discord bot instructions  
✅ Download ID input (8 chars)  
✅ Example Download ID display  
✅ Expiry warning (24 hours)  
✅ Forum-style UI  
✅ Community discussions  
✅ Bot commands reference  
✅ Stats dashboard  
✅ **Vouch verification system**  
✅ **Auto-check vouch status**

## Testing

### 1. Test Webhook (from bot)

```bash
curl -X POST https://www.fivemtools.net/api/decrypt/webhook \
  -H "Authorization: Bearer your-secure-api-key-here" \
  -H "Content-Type: application/json" \
  -d '{
    "downloadId": "TEST1234",
    "filename": "test_decrypted.lua",
    "content": "-- Test content\nprint(\"Hello World\")",
    "status": "completed"
  }'
```

### 2. Test Download

```bash
curl https://www.fivemtools.net/api/decrypt/download/TEST1234
```

### 3. Test on Website

1. Login to https://www.fivemtools.net
2. Go to /decrypt page
3. Enter Download ID: `TEST1234`
4. Click "Download Decrypted File"

## Production Checklist

- [x] Website URL configured: https://www.fivemtools.net
- [x] Vouch channel ID: 1445794466605826343
- [ ] Discord webhook URL set
- [ ] Discord bot API key generated
- [ ] Discord bot token set (for vouch checking)
- [ ] Bot sends to webhook endpoint
- [ ] Test vouch verification
- [ ] Test download flow
- [ ] Setup database (replace Map storage)
- [ ] Add rate limiting
- [ ] Setup monitoring
- [ ] Add download analytics

## Notes

- Upload is DISABLED on website
- All decryption happens in Discord bot
- Website only serves downloads
- Downloads expire after 24 hours
- Download ID is case-insensitive (auto-uppercase)
- **VOUCH IS REQUIRED** - Users must post in channel 1445794466605826343
- Vouch is checked by fetching last 100 messages from channel
- If no vouch found, user cannot access decrypt page
